      # (ì•ë¶€ë¶„ ìƒëµ...)
      
      # -------------------------------------------------------------------------
      # Step 5: SSMì„ í†µí•´ ASGì˜ ëª¨ë“  EC2 ì¸ìŠ¤í„´ìŠ¤ì— ë°°í¬
      # -------------------------------------------------------------------------
      - name: Deploy to ASG via SSM
        run: |
          # ë°°í¬í•  ì´ë¯¸ì§€ ì •ë³´
          REGISTRY="${{ steps.login-ecr.outputs.registry }}"
          REPO="${{ secrets.ECR_REPOSITORY }}"
          TAG="${{ github.sha }}"
          FULL_IMAGE="$REGISTRY/$REPO:$TAG"

          # SSM ëª…ë ¹ ì „ì†¡ (íŠ¹ì • íƒœê·¸ë¥¼ ê°€ì§„ ëª¨ë“  EC2 ëŒ€ìƒ)
          COMMAND_ID=$(aws ssm send-command \
            --targets "Key=tag:${{ secrets.ASG_TAG_KEY }},Values=${{ secrets.ASG_TAG_VALUE }}" \
            --document-name "AWS-RunShellScript" \
            --comment "Deploying Nginx via GitHub Actions" \
            --region ${{ secrets.AWS_REGION }} \
            --parameters "{
              \"commands\": [
                \"# ECR ë¡œê·¸ì¸\",
                \"aws ecr get-login-password --region ${{ secrets.AWS_REGION }} | sudo docker login --username AWS --password-stdin $REGISTRY\",

                \"# ìƒˆ ì´ë¯¸ì§€ pull\",
                \"sudo docker pull $FULL_IMAGE\",

                \"# ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì‚­ì œ\",
                \"sudo docker stop nginx-server || true\",
                \"sudo docker rm nginx-server || true\",

                \"# ìƒˆ ì»¨í…Œì´ë„ˆ ì‹¤í–‰\",
                \"sudo docker run -d --name nginx-server -p 80:80 $FULL_IMAGE\",

                \"# ë¯¸ì‚¬ìš© ì´ë¯¸ì§€ ì •ë¦¬\",
                \"sudo docker image prune -f\"
              ]
            }" \
            --query 'Command.CommandId' \
            --output text)

          echo "âœ… ë°°í¬ ëª…ë ¹(SSM) ì „ì†¡ ì™„ë£Œ! Command ID: $COMMAND_ID"
          echo "ğŸš€ ê° EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë°±ê·¸ë¼ìš´ë“œë¡œ ë°°í¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤."

          # [ì‚­ì œë¨] ì•„ë˜ wait ëª…ë ¹ì–´ëŠ” ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ìš©ì´ë¼ ì—ëŸ¬ ìœ ë°œí•¨. ì‚­ì œ ë˜ëŠ” ì£¼ì„ ì²˜ë¦¬.
          # echo "Waiting for SSM command $COMMAND_ID to complete..."
          # aws ssm wait command-executed \
          #   --command-id "$COMMAND_ID" \
          #   --region ${{ secrets.AWS_REGION }} \
          #   --max-attempts 30 \
          #   --delay 10
